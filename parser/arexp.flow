import maybe;
import lingo/pegcode/driver;

export {
    ArExp ::= ArSum, ArRes, ArProd, ArDiv, ArInt;
    ArSum : (l: ArExp, r: ArExp);
    ArProd : (l: ArExp, r: ArExp);
    ArRes : (l: ArExp, r: ArExp);
    ArDiv : (l: ArExp, r: ArExp);
    ArInt : (val: int);

    parse(s: string) -> Maybe<ArExp>;
    ae2s(a: ArExp) -> string;
}

grammar = "#include arexp.lingo";

parse(s: string) -> Maybe<ArExp>{
    parser = compilePegGrammar(grammar);
    ret = parsic3(parser, s, defaultPegActions, ArInt(0));
    if(ret.third == "") { Some(ret.first); } else { None() }
}

ae2s(a: ArExp) -> string{
    switch(a){
        ArSum(l,r): ("(" + ae2s(l) + " + " + ae2s(r) + ")");
        ArRes(l,r): ("(" + ae2s(l) + " - " + ae2s(r) + ")");
        ArProd(l,r): ("(" + ae2s(l) + " * " + ae2s(r) + ")");
        ArDiv(l,r): ("(" + ae2s(l) + " / " + ae2s(r) + ")");
        ArInt(v): (i2s(v));
    }
}